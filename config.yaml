log:
  level: warn

githubReleases:
  - owner: "kubevirt"
    repo: "kubevirt"
    assets:
      - "kubevirt-operator.yaml"
      - "kubevirt-cr.yaml"
    chart: "charts/kubevirt"
    filter:
      - namespace
      - namespaces
    replacements: | 
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: Deployment
            fieldPaths:
              - "metadata.namespace"
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: KubeVirt
            fieldPaths:
              - "metadata.namespace"
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: Role
            fieldPaths:
              - "metadata.namespace"
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: RoleBinding
            fieldPaths:
              - "metadata.namespace"
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: ServiceAccount
            fieldPaths:
              - "metadata.namespace"
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: RoleBinding
            fieldPaths:
              - subjects.[kind=ServiceAccount].namespace
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: ClusterRoleBinding
            fieldPaths:
              - subjects.[kind=ServiceAccount].namespace

  - owner: "kubevirt"
    repo: "containerized-data-importer"
    assets:
      - "cdi-operator.yaml"
      - "cdi-cr.yaml"
    chart: "charts/cdi"
    filter:
      - namespace
      - namespaces
    replacements: |
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: Deployment
            fieldPaths:
              - "metadata.namespace"
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: Role
            fieldPaths:
              - "metadata.namespace"
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: RoleBinding
            fieldPaths:
              - "metadata.namespace"
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: ServiceAccount
            fieldPaths:
              - "metadata.namespace"
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: RoleBinding
            fieldPaths:
              - subjects.[kind=ServiceAccount].namespace
      - sourceValue: "{{ .Release.Namespace }}"
        targets:
          - select:
              kind: ClusterRoleBinding
            fieldPaths:
              - subjects.[kind=ServiceAccount].namespace
      - sourceValue: "{{ .Values.cdi.infra.nodeSelector | toYaml | nindent 10 }}"
        targets:
          - select:
              kind: CDI
            fieldPaths:
              - "spec.infra.nodeSelector"
      - sourceValue: "{{ .Values.cdi.infra.tolerations | toYaml | nindent 10 }}"
        targets:
          - select:
              kind: CDI
            fieldPaths:
              - "spec.infra.tolerations"
      - sourceValue: "{{ .Values.cdi.workload.nodeSelector | toYaml | nindent 10 }}"
        targets:
          - select:
              kind: CDI
            fieldPaths:
              - "spec.workload.nodeSelector"
